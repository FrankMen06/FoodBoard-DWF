<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Informe de Ventas</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
</head>
<body>
<div class="container mt-5">
    <ul class="nav nav-pills" id="pills-tab" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="pills-profile-tab" data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile" aria-selected="true">Informe de Ventas</a>
        </li>
    </ul>

    <div class="tab-content" id="pills-tabContent">
        <div class="tab-pane fade show active" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-3">
                        <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical" style="width: 200px;">
                            <a class="nav-link active" id="v-pills-home-tab" data-toggle="pill" href="#v-pills-home" role="tab" aria-controls="v-pills-home" aria-selected="true">Mensual</a>
                            <a class="nav-link" id="v-pills-profile-tab" data-toggle="pill" href="#v-pills-profile" role="tab" aria-controls="v-pills-profile" aria-selected="false">Anual</a>
                        </div>
                    </div>
                    <div class="col-md-9">
                        <div class="tab-content" id="v-pills-tabContent">
                            <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab">
                                <h1 class="text-center display-4">Informe de ventas Mensual</h1>
                                <br/>
                                <form th:action="@{descargarReporte.descargarInforme('mes', ordenManaged.anioo)}" method="post">
                                    <button type="submit" class="btn btn-outline-success" th:if="${#lists.isNotEmpty(ordenManaged.modelo.años())}">Descargar Informe</button>
                                </form>
                                <br/>
                                <div class="container">
                                    <div class="form-group float-right" style="width: 25%;">
                                        <h3 class="lead font-weight-bold">Seleccionar año:</h3>
                                        <form th:action="@{ordenar}" method="post">
                                            <select class="form-control" id="ordenar" th:field="${ordenManaged.anioo}" th:onchange="this.form.submit()">
                                                <option th:each="a : ${ordenManaged.modelo.años()}" th:value="${a}" th:text="${a}"></option>
                                            </select>
                                        </form>
                                    </div>
                                </div>
                                <form id="mensual">
                                    <br/><br/>
                                    <div th:if="${ordenManaged.anioo == 0}">
                                        <p class="lead text-center"><b>Reporte mensual del año [[${ordenManaged.anioActual()}]]</b></p>
                                    </div>
                                    <div th:if="${ordenManaged.anioo > 0}">
                                        <p class="lead text-center"><b>Reporte mensual del año [[${ordenManaged.anioo}]]</b></p>
                                    </div>
                                    <br>
                                    <table class="table text-center">
                                        <thead class="thead-dark">
                                        <tr>
                                            <th scope="col">Mes</th>
                                            <th scope="col">Venta del mes</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr th:each="m, iterStat : ${ordenManaged.informeMensual()}" th:object="${m}">
                                            <td th:text="${m[0]}"></td>
                                            <td th:text="'$' + ${m[1]}"></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                    <br/>
                                    <div th:if="${ordenManaged.anioo == 0}">
                                        <p class="lead text-center"><b>Venta total del año [[${ordenManaged.anioActual()}]]: $[[${ordenManaged.totalCarrito}]]</b></p>
                                    </div>
                                    <div th:if="${ordenManaged.anioo > 0}">
                                        <p class="lead text-center"><b>Venta total del año [[${ordenManaged.anioo}]]: $[[${ordenManaged.totalCarrito}]]</b></p>
                                    </div>
                                    <div class="ui-g">
                                        <div class="ui-g-6">
                                            <p:panel>
                                                <p:donutChart model="#{grafica.donutModel}" style="width: 100%; height: 200px;" />
                                            </p:panel>
                                        </div>
                                        <div class="ui-g-6">
                                            <p:panel>
                                                <p:barChart model="#{grafica.mixedModel}" style="width: 100%; height: 200px;" />
                                            </p:panel>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="tab-pane fade" id="v-pills-profile" role="tabpanel" aria-labelledby="v-pills-profile-tab">
                                <h1 class="text-center display-4">Informe de ventas</h1>
                                <br/>
                                <p class="lead text-center"><b>Reporte Anual</b></p>
                                <br>
                                <form th:action="@{descargarReporte.descargarInforme('anioooo', ordenManaged.anioo)}" method="post">
                                    <button type="submit" class="btn btn-outline-success" th:if="${#lists.isNotEmpty(ordenManaged.modelo.años())}">Descargar Informe</button>
                                </form>
                                <br/>
                                <table class="table text-center">
                                    <thead class="thead-dark">
                                    <tr>
                                        <th scope="col">Año</th>
                                        <th scope="col">Venta del año</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="m, iterStat : ${ordenManaged.modelo.informeAnual()}" th:object="${m}">
                                        <td th:text="${m[0]}"></td>
                                        <td th:text="'$' + ${m[1]}"></td>
                                    </tr>
                                    </tbody>
                                </table>
                                <br/>
                                <p class="lead text-center"><b>Venta total: $[[${ordenManaged.totalCarrito}]]</b></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
        </div>
    </div>
</div>

<script>
    function descargarTodo(titulo) {
        html2canvas(document.getElementById('todo')).then(function(canvas) {
            var imageData = canvas.toDataURL();
            var link = document.createElement('a');
            link.href = imageData;
            link.download = titulo+'.png';
            link.click();
        });
    }

    function descargarMes(titulo) {
        html2canvas(document.getElementById('mes')).then(function(canvas) {
            var imageData = canvas.toDataURL();
            var link = document.createElement('a');
            link.href = imageData;
            link.download = titulo+'.png';
            link.click();
        });
    }

    function descargarAnio(titulo) {
        html2canvas(document.getElementById('anioo')).then(function(canvas) {
            var imageData = canvas.toDataURL();
            var link = document.createElement('a');
            link.href = imageData;
            link.download = titulo+'.png';
            link.click();
        });
    }
</script>
</body>
</html>